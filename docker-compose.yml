version: '2'
services:
  irods:
    build:
      context: icat/
      args:
        ENV_IRODS_VERSION: ${ENV_IRODS_VERSION}
        ENV_IRODS_EXT_CLANG_VERSION: ${ENV_IRODS_EXT_CLANG_VERSION}
        ENV_IRODS_EXT_CLANG_RUNTIME_VERSION: ${ENV_IRODS_EXT_CLANG_RUNTIME_VERSION}
        ENV_CMAKE_VERSION: ${ENV_CMAKE_VERSION}
        ENV_CMAKE_LONG_VERSION: ${ENV_CMAKE_LONG_VERSION}
        ENV_FILEBEAT_VERSION: ${ENV_FILEBEAT_VERSION}
    hostname: irods
    ports:
      - "1247:1247"
      - "1248:1248"
    environment:
      RODS_PASSWORD: irods
      PGPASSWORD: foobar
      VIRTUAL_HOST: irods.${RIT_ENV}.rit.unimaas.nl
    networks:
      - default
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ./irods.secrets.cfg:/etc/secrets:ro
  ires-ceph:
    build:
      context: ires-ceph/
      args:
        ENV_IRODS_VERSION: ${ENV_IRODS_VERSION}
        ENV_IRODS_EXT_CLANG_VERSION: ${ENV_IRODS_EXT_CLANG_VERSION}
        ENV_IRODS_EXT_CLANG_RUNTIME_VERSION: ${ENV_IRODS_EXT_CLANG_RUNTIME_VERSION}
        ENV_CMAKE_VERSION: ${ENV_CMAKE_VERSION}
        ENV_CMAKE_LONG_VERSION: ${ENV_CMAKE_LONG_VERSION}
        ENV_DOCKERIZE_VERSION: ${ENV_DOCKERIZE_VERSION}
    hostname: ires-ceph
    environment:
      RODS_PASSWORD: irods
      PGPASSWORD: foobar
      VIRTUAL_HOST: ires-ceph.${RIT_ENV}.rit.unimaas.nl
    networks:
      - default
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ./irods.secrets.cfg:/etc/secrets:ro
      - ./externals/irods_resource_plugin_rados:/irods_resource_plugin_rados
  irods-db:
    image: postgres:${ENV_POSTGRES_VERSION}
    hostname: irods-db
    environment:
      POSTGRES_PASSWORD: foobar
    volumes:
      - /etc/localtime:/etc/localtime:ro
